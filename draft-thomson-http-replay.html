<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Using TLS Early Data in HTTP</title>

  
<style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  ul.toc, #rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    padding: 0 1em;
    z-index: 1;
  }
  #rfc\.toc {
    top: 16px;
  }
  ul.toc {
    top: 80px;
    overflow: auto;
  }

  body {
    padding-left: 1.5em;
    padding-right: 29em;
  }
}

body {
  font: 15px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 2.5em auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 30px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc ul {
  margin: 0;
}
/* xml2rfc nests ul directly inside ul which messes with the style badly */
ul.toc, ul.toc>ul, ul.toc ul>ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p {
  font-size: 20px;
  font-weight: 300;
  line-height: 130%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}
address {
  font-style: normal;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Conventions and Definitions">
<link href="#rfc.section.3" rel="Chapter" title="3 Retries in HTTP">
<link href="#rfc.section.4" rel="Chapter" title="4 TLS Early Data in HTTP">
<link href="#rfc.section.5" rel="Chapter" title="5 Replay Attacks">
<link href="#rfc.section.6" rel="Chapter" title="6 Reducing the Risk of Replay">
<link href="#rfc.section.7" rel="Chapter" title="7 Replay Avoidance for Gateways">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 The Early-Data Header Field">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 The 422 (Too Early) Status Code">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.references.1" rel="Chapter" title="10.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="10.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.6.1 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Thomson, M., Nottingham, M., and W. Tarreau" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-thomson-http-replay-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2017-6-20" />
  <meta name="dct.abstract" content="TLS early data presents both an opportunity and a risk.  The risks of using TLS early data are explained as they relate to HTTP.  A technique for reducing these risks is described, including mechanisms that enable the use of that technique at intermediaries." />
  <meta name="description" content="TLS early data presents both an opportunity and a risk.  The risks of using TLS early data are explained as they relate to HTTP.  A technique for reducing these risks is described, including mechanisms that enable the use of that technique at intermediaries." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">httpbis</td>
<td class="right">M. Thomson</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Mozilla</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">M. Nottingham</td>
</tr>
<tr>
<td class="left">Expires: December 22, 2017</td>
<td class="right">true</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">W. Tarreau</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Exceliance</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">June 20, 2017</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Using TLS Early Data in HTTP<br />
  <span class="filename">draft-thomson-http-replay-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>TLS early data presents both an opportunity and a risk.  The risks of using TLS early data are explained as they relate to HTTP.  A technique for reducing these risks is described, including mechanisms that enable the use of that technique at intermediaries.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 22, 2017.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2017 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Conventions and Definitions</a>
</li>
<li>3.   <a href="#rfc.section.3">Retries in HTTP</a>
</li>
<li>4.   <a href="#rfc.section.4">TLS Early Data in HTTP</a>
</li>
<li>5.   <a href="#rfc.section.5">Replay Attacks</a>
</li>
<li>6.   <a href="#rfc.section.6">Reducing the Risk of Replay</a>
</li>
<li>7.   <a href="#rfc.section.7">Replay Avoidance for Gateways</a>
</li>
<ul><li>7.1.   <a href="#rfc.section.7.1">The Early-Data Header Field</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">The 422 (Too Early) Status Code</a>
</li>
</ul><li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<ul><li>10.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>10.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">TLS 1.3 <a href="#TLS13" class="xref">[TLS13]</a> introduces the concept of early data, or zero round trip data.  Early data allows a client to send data to a server in the first round trip of a connection, without waiting for the TLS handshake to complete, if the client has spoken to the same server recently.</p>
<p id="rfc.section.1.p.2">For HTTP <a href="#HTTP" class="xref">[HTTP]</a>, early data allows clients to send requests immediately, avoiding the one or two round trip time needed for the TLS handshake.  This is a significant performance enhancement, however early data has some significant limitations.</p>
<p id="rfc.section.1.p.3">The primary cost of using early data is the risk that an attacker might capture and replay the early data.  TLS <a href="#TLS13" class="xref">[TLS13]</a> describes techniques that reduce the likelihood that an attacker can successfully replay a request, but these techniques can be difficult to deploy and it could be impossible to guarantee perfect protection against replay attack.</p>
<p id="rfc.section.1.p.4">This document explores how HTTP treats both retries and replays of requests.</p>
<p id="rfc.section.1.p.5">To help mitigate the risk of replay, a technique for controlling the risks inherent to the use of early data is outlined, including a mechanism that grants a gateway the ability to apply this technique.  This technique ensures that the choice to expose a request to the possibility of replay is mutual: client and server will both need to agree to accept the risk.</p>
<p id="rfc.section.1.p.6">The advice in this document also applies to use of 0-RTT in HTTP over QUIC <a href="#HQ" class="xref">[HQ]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#conventions-and-definitions" id="conventions-and-definitions">Conventions and Definitions</a>
</h1>
<p id="rfc.section.2.p.1">The words &#8220;MUST&#8221;, &#8220;MUST NOT&#8221;, &#8220;SHOULD&#8221;, and &#8220;MAY&#8221; are used in this document.  It&#8217;s not shouting; when they are capitalized, they have the special meaning defined in <a href="#RFC2119" class="xref">[RFC2119]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#retries-in-http" id="retries-in-http">Retries in HTTP</a>
</h1>
<p id="rfc.section.3.p.1">In many circumstances, HTTP requests are retried.  Applications care about reliability and will frequently retry requests in the event of errors.  Many HTTP libraries or intermediaries automatically retry requests in certain conditions.</p>
<p id="rfc.section.3.p.2">Idempotent methods <a href="#RFC7231" class="xref">[RFC7231]</a> are specifically defined to support automatic retry.  Processing a request with an idempotent method more than once does not result in a different end state.  HTTP/2 <a href="#HTTP2" class="xref">[HTTP2]</a> also defines circumstances in which automatic retry of a request does not result in duplicate processing at a server, allowing retry of requests with non-idempotent methods.</p>
<p id="rfc.section.3.p.3">However, many clients will retry a request even if a retry is not safe.  For instance, many clients will retry POST requests if a connection is terminated before any octets of a response are received.  Even in the absence of automatic retries, when errors are presented to users, users might initiate a retry, by pressing a &#8220;reload&#8221; button or re-initiating a transaction.</p>
<p id="rfc.section.3.p.4">The prevalence of retries means that applications that use HTTP SHOULD implement measures for detecting and rejecting unwanted retries.  This can be seen as an application of the end-to-end principle of system design <a href="#E2E" class="xref">[E2E]</a>: no protocol is expected to simultaneously provide a guarantee of at-most-once delivery and error tolerance.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#tls-early-data-in-http" id="tls-early-data-in-http">TLS Early Data in HTTP</a>
</h1>
<p id="rfc.section.4.p.1">A server can decide whether or not to offer clients the ability to send early data.  This decision is made when sending a session ticket to clients.</p>
<p id="rfc.section.4.p.2">A client that wishes to use early data commences sending requests immediately after sending the TLS ClientHello.  If early data is accepted, early data is concatenated with other application to form a single stream of data.</p>
<p id="rfc.section.4.p.3">A server cannot choose to selectively reject early data.  TLS only permits a server to accept all early data, or none of it.  Once a server has decided to accept early data, it MUST process the messages that are sent by the client in early data.</p>
<p id="rfc.section.4.p.4">If a server rejects early data, a client MUST start sending again as though the connection was new.  For HTTP/2, this means re-sending the connection preface.  Any requests sent in early data MUST be sent again, unless the client decides to abandon those requests.</p>
<p id="rfc.section.4.p.5">This results in a potential replay where the early data is sent to one server instance and the connection attempt is separately allowed to complete where the server instance rejects the early data.  Replays are also possible if there are multiple server instances that will accept early data, or if the same server accepts early data multiple times (though this would be in violation of requirements in TLS).</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#replay-attacks" id="replay-attacks">Replay Attacks</a>
</h1>
<p id="rfc.section.5.p.1">What distinguishes a replay attack from a retry is that a retry is explicitly initiated by a client or user.  A client that attempts a retry In contrast, a replay attack is initiated by an attacker.  The attacker creates a copy of the messages sent by a client and replays these messages without the knowledge or consent of the client.</p>
<p id="rfc.section.5.p.2">For application data that is sent after the TLS handshake completes, TLS provides protection against replay.  Duplicated data is detected and treated as a fatal error condition (in DTLS <a href="#DTLS" class="xref">[DTLS]</a>, duplicated data is instead discarded).  Similarly, transport layer loss recovery, such as TCP retransmission, does not generate replays because the transport discards duplicated data.</p>
<p id="rfc.section.5.p.3">TLS early data creates the potential for a replay attack that cannot be detected by TLS or the transport protocol.  TLS <a href="#TLS13" class="xref">[TLS13]</a> describes several mitigation strategies that reduce the ability of an attacker to successfully replay early data.  Servers are strongly encouraged to implement these techniques, but to also recognize that they are imperfect.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#reducing-the-risk-of-replay" id="reducing-the-risk-of-replay">Reducing the Risk of Replay</a>
</h1>
<p id="rfc.section.6.p.1">It is immediately obvious that a client can make an explicit choice on each request it makes as to whether it sends that request in early data.  This gives a client explicit control over whether a given request is exposed to the risk of replay.</p>
<p id="rfc.section.6.p.2">A server can also choose whether it processes early data before the TLS handshake completes.  By deferring processing for a request until the handshake is complete, it can ensure that only a successfully completed connection is used for processing early requests.  Assuming that a replayed ClientHello will not result in additional connections being made by the client, this provides the server with some assurance that the early data was not replayed.</p>
<p id="rfc.section.6.p.3">If the server receives multiple requests in early data, it can make a determination about whether to defer processing on a per-request basis.</p>
<p id="rfc.section.6.p.4">The amount of data that a client can send in early data can be limited by a server using the <samp>max_early_data_size</samp> field that is sent when a server enables early data.  A server can use this to avoid having to commit an arbitrary amount of memory for deferred requests.  A server SHOULD ensure that when it accepts early data, it can defer processing of requests until after the TLS handshake completes.</p>
<p id="rfc.section.6.p.5">Using this technique ensures that, for any given request, both client and server need to agree to accept the risk of replay if that risk exists.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#replay-avoidance-for-gateways" id="replay-avoidance-for-gateways">Replay Avoidance for Gateways</a>
</h1>
<p id="rfc.section.7.p.1">A generic gateway might be unable to make a determination about whether a given request can be processed safely when it is sent in early data.  In many cases, only the origin server has the necessary information to decide whether the risk of replay is acceptable.</p>
<p id="rfc.section.7.p.2">This leads to a strong incentive for gateways to be quite conservative, either disabling early data entirely, or only allowing a narrow subset of requests to be forwarded.</p>
<p id="rfc.section.7.p.3">To improve the ability of a gateway to accept and forward requests that arrive in early data, two signaling mechanisms are defined:</p>
<p></p>

<ul>
<li>The <samp>Early-Data</samp> header field is added to any request that is sent or received in early data.</li>
<li>The 422 (Too Early) status code is defined for an origin server to indicate that a request could not be processed due to the consequences of a possible replay attack.</li>
</ul>
<p id="rfc.section.7.p.5">In order for this technique to work well, the gateway needs to be certain that the origin server will understand the <samp>Early-Data</samp> header field and correctly generate the 422 status code if it does not wish to process the request.</p>
<h2 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> <a href="#the-early-data-header-field" id="the-early-data-header-field">The Early-Data Header Field</a>
</h2>
<p id="rfc.section.7.1.p.1">The <samp>Early-Data</samp> header field is defined with two values, &#8220;0&#8221; and &#8220;1&#8221;.  Here it is shown using the ABNF <a href="#ABNF" class="xref">[ABNF]</a>:</p>
<pre>
Early-Data = "0" / "1"
</pre>
<p id="rfc.section.7.1.p.2">For example:</p>
<pre>
POST /resource HTTP/1.0
Host: example.com
Early-Data: 1
Content-Length: 14

message body
</pre>
<p id="rfc.section.7.1.p.3">A client SHOULD include the <samp>Early-Data</samp> header field with a value of &#8220;1&#8221; if it sends a request in TLS early data.  This indicates to the intermediary or server that it understands the 422 (Too Early) status code and is prepared to retry the request.</p>
<p id="rfc.section.7.1.p.4">The <samp>Early-Data</samp> header field is omitted from a request or set to &#8220;0&#8221; when the request arrives after the TLS handshake completes.  An intermediary MUST NOT add this header field with a value of &#8220;0&#8221; or remove a header field if it has a value of &#8220;1&#8221;.</p>
<p id="rfc.section.7.1.p.5">A <samp>Early-Data</samp> header field with a value of &#8220;1&#8221; is added to a request when forwarding a request from a connection that has an incomplete TLS handshake.  In other words, a value of &#8220;1&#8221; identifies requests that were sent in TLS early data.  A value of &#8220;1&#8221; indicates that the request might have been replayed.</p>
<p id="rfc.section.7.1.p.6">An intermediary that receives a request in TLS early data can forward the request with the <samp>Early-Data</samp> header field add and set to &#8220;1&#8221;.  If the server responds with a 422 (Too Early) status code, the intermediary can then wait until the TLS handshake completes and forward the request again.</p>
<h2 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> <a href="#the-422-too-early-status-code" id="the-422-too-early-status-code">The 422 (Too Early) Status Code</a>
</h2>
<p id="rfc.section.7.2.p.1">A 422 (Too Early) status code indicates that the server that is unwilling to risk processing requests that might be replayed.</p>
<p id="rfc.section.7.2.p.2">The primary use of this header field is to cause clients or intermediaries to retry a request.  A client or intermediary MAY retry any request automatically if they receive a 422 (Too Early) status code.  A request that receives a 422 (Too Early) status code MUST NOT be retried in TLS early data.</p>
<p id="rfc.section.7.2.p.3">An intermediary that forwards a request SHOULD wait until the TLS handshake on the connection that carries the original request is complete before retrying.  If the original request that arrived at the intermediary contained an <samp>Early-Data</samp> header field with a value of &#8220;1&#8221;, the intermediary MAY instead forward the 422 (Too Early) status code.</p>
<p id="rfc.section.7.2.p.4">A server SHOULD NOT generate the 422 (Too Early) status code unless the request includes an <samp>Early-Data</samp> header field with a value of &#8220;1&#8221;.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<p id="rfc.section.8.p.1">Using early data exposes a client to the risk that their request is replayed.  A retried or replayed request can produce different side effects on the server.  That might be used for traffic analysis to recover information about requests or the resources those requests target.</p>
<p id="rfc.section.8.p.2">A gateway that forwards requests that were received in early data MUST only do so if it knows that the server that receives those requests understands the <samp>Early-Data</samp> header field and will correctly generate a 422 (Too Early) status code.  A gateway that isn&#8217;t certain about server support SHOULD either delay forwarding the request until the TLS handshake completes, or send a 422 (Too Early) status code in response.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.9.p.1">This document registers the <samp>Early-Data</samp> header field in the &#8220;Message Headers&#8221; registry <a href="#HEADERS" class="xref">[HEADERS]</a>.</p>
<p></p>

<dl>
<dt>Header field name:</dt>
<dd style="margin-left: 8">Early-Data</dd>
<dt>Applicable protocol:</dt>
<dd style="margin-left: 8">http</dd>
<dt>Status:</dt>
<dd style="margin-left: 8">standard</dd>
<dt>Author/Change controller:</dt>
<dd style="margin-left: 8">IETF</dd>
<dt>Specification document(s):</dt>
<dd style="margin-left: 8">This document</dd>
<dt>Related information:</dt>
<dd style="margin-left: 8">(empty)</dd>
</dl>
<p id="rfc.section.9.p.3">This document registers the 422 (Too Early) status code in the &#8220;Hypertext Transfer Protocol (HTTP) Status Code&#8221; registry established in <a href="#RFC7231" class="xref">[RFC7231]</a>.</p>
<p></p>

<dl>
<dt>Value:</dt>
<dd style="margin-left: 8">422</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Too Early</dd>
<dt>Reference:</dt>
<dd style="margin-left: 8">This document</dd>
</dl>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<h2 id="rfc.references.1">
<a href="#rfc.references.1">10.1.</a> Normative References</h2>
<table><tbody>
<tr>
<td class="reference"><b id="ABNF">[ABNF]</b></td>
<td class="top">
<a>Crocker, D.</a> and <a>P. Overell</a>, "<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>", STD 68, RFC 5234, DOI 10.17487/RFC5234, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="HEADERS">[HEADERS]</b></td>
<td class="top">
<a>Klyne, G.</a>, <a>Nottingham, M.</a> and <a>J. Mogul</a>, "<a href="http://tools.ietf.org/html/rfc3864">Registration Procedures for Message Header Fields</a>", BCP 90, RFC 3864, DOI 10.17487/RFC3864, September 2004.</td>
</tr>
<tr>
<td class="reference"><b id="HTTP">[HTTP]</b></td>
<td class="top">
<a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>", RFC 7230, DOI 10.17487/RFC7230, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7231">[RFC7231]</b></td>
<td class="top">
<a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="http://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>", RFC 7231, DOI 10.17487/RFC7231, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="TLS13">[TLS13]</b></td>
<td class="top">
<a>Rescorla, E.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-tls-tls13-20">The Transport Layer Security (TLS) Protocol Version 1.3</a>", Internet-Draft draft-ietf-tls-tls13-20, April 2017.</td>
</tr>
</tbody></table>
<h2 id="rfc.references.2">
<a href="#rfc.references.2">10.2.</a> Informative References</h2>
<table><tbody>
<tr>
<td class="reference"><b id="DTLS">[DTLS]</b></td>
<td class="top">
<a>Rescorla, E.</a> and <a>N. Modadugu</a>, "<a href="http://tools.ietf.org/html/rfc6347">Datagram Transport Layer Security Version 1.2</a>", RFC 6347, DOI 10.17487/RFC6347, January 2012.</td>
</tr>
<tr>
<td class="reference"><b id="E2E">[E2E]</b></td>
<td class="top">
<a>Saltzer, J.</a>, <a>Reed, D.</a> and <a>D. Clark</a>, "<a>End-to-end arguments in system design</a>", ACM Transactions on Computer Systems Vol. 2, pp. 277-288, DOI 10.1145/357401.357402, November 1984.</td>
</tr>
<tr>
<td class="reference"><b id="HQ">[HQ]</b></td>
<td class="top">
<a>Bishop, M.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-quic-http-04">Hypertext Transfer Protocol (HTTP) over QUIC</a>", Internet-Draft draft-ietf-quic-http-04, June 2017.</td>
</tr>
<tr>
<td class="reference"><b id="HTTP2">[HTTP2]</b></td>
<td class="top">
<a>Belshe, M.</a>, <a>Peon, R.</a> and <a>M. Thomson</a>, "<a href="http://tools.ietf.org/html/rfc7540">Hypertext Transfer Protocol Version 2 (HTTP/2)</a>", RFC 7540, DOI 10.17487/RFC7540, May 2015.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Martin Thomson</span> 
	  <span class="n hidden">
		<span class="family-name">Thomson</span>
	  </span>
	</span>
	<span class="org vcardline">Mozilla</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:martin.thomson@gmail.com">martin.thomson@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mark Nottingham</span> 
	  <span class="n hidden">
		<span class="family-name">Nottingham</span>
	  </span>
	</span>
	<span class="org vcardline">true</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mnot@mnot.net">mnot@mnot.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Willy Tarreau</span> 
	  <span class="n hidden">
		<span class="family-name">Tarreau</span>
	  </span>
	</span>
	<span class="org vcardline">Exceliance</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:w@1wt.eu">w@1wt.eu</a></span>

  </address>
</div>

  <div class="github-fork-ribbon-wrapper"><div class="github-fork-ribbon"><a href="https://github.com/martinthomson/http-replay">Fork me on GitHub</a></div></div>
</body>
</html>
